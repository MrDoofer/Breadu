[gd_scene load_steps=18 format=3 uid="uid://8013psc2yag6"]

[ext_resource type="Script" uid="uid://crmke5rcafwi1" path="res://Scripts/game.gd" id="1_o0h88"]
[ext_resource type="PackedScene" uid="uid://d32gkh7jhof5a" path="res://Scenes/burbur.tscn" id="1_txd6a"]
[ext_resource type="Texture2D" uid="uid://m5sfreasoygs" path="res://sprites/2d_lights_and_shadows_neutral_point_light.webp" id="2_igyqu"]
[ext_resource type="Texture2D" uid="uid://bauk05youv3so" path="res://sprites/Spritesheet.png" id="3_1yb1k"]
[ext_resource type="Shader" uid="uid://b37beo5nm1aw8" path="res://Shaders/crt.gdshader" id="5_xfjr0"]
[ext_resource type="PackedScene" uid="uid://cvk1i2njqmxjd" path="res://Scenes/grass.tscn" id="6_2t1ve"]
[ext_resource type="Shader" uid="uid://dds2hq8phrbw8" path="res://Shaders/Water.gdshader" id="6_olox2"]
[ext_resource type="PackedScene" uid="uid://b7eq6rqvb2ddb" path="res://Scenes/pause_menu.tscn" id="7_4ca43"]
[ext_resource type="PackedScene" uid="uid://dixfxgd3g4sro" path="res://Scenes/Loaf.tscn" id="9_2vfwe"]

[sub_resource type="Shader" id="Shader_1c764"]
code = "shader_type canvas_item;

uniform float first_stage : hint_range(0.0, 1.0) = 0.5; 
uniform float first_smooth : hint_range(0.0, 1.0) = 0.0; // Lengthens the color transition
uniform float second_stage : hint_range(0.0, 1.0) = 0.0;   // If left at 0, only level 1 is used.
uniform float second_smooth : hint_range(0.0, 1.0) = 0.0;
uniform float min_light : hint_range(0.0, 1.0) = 0.0;
uniform float mid_light : hint_range(0.0, 1.0) = 0.0;
uniform float max_light : hint_range(0.0, 1.0) = 1.0;
uniform float obj_light_add : hint_range(0.0, 1.0) = 0.0;

float light_calc(float light_strength, float would_be_strength) {
	float target_strength = light_strength + would_be_strength * obj_light_add;
	if (target_strength == 0.0) {target_strength = 0.000001;}
	if (would_be_strength == 0.0) {would_be_strength = 1.0;}
	return(target_strength / would_be_strength);
}

void light() {
	float level_1 = first_stage;
	float level_1_smooth = first_smooth;
	float level_2 = second_stage;
	float level_2_smooth = second_smooth;
	
	float mid_range_light = mid_light;
	if (mid_light == 0.0) { mid_range_light = max_light * 0.5; }
	vec3 light_normal = normalize(vec3(LIGHT_VEC, -LIGHT_HEIGHT));
	float would_be_strength = max(dot(-light_normal, NORMAL), 0.0);
	if (would_be_strength > level_1 && level_2 == 0.0 ) {
		float diff = smoothstep(level_1, (level_1 + level_1_smooth), would_be_strength) + min_light;
		if (diff >= max_light) {diff = max_light;}
		LIGHT *= light_calc(diff, would_be_strength);
	} else if (would_be_strength > level_1 && would_be_strength < level_2 && level_2 != 0.0 ) {
		float diff = smoothstep(level_1, (level_1 + level_1_smooth), would_be_strength) + min_light;
		if (diff >= mid_range_light ) {diff = mid_range_light;}
		LIGHT *= light_calc(diff, would_be_strength);
	} else if (would_be_strength >= level_2 && level_2 != 0.0 ) {
		float diff = smoothstep(level_2, (level_2 + level_2_smooth), would_be_strength) + mid_range_light;
		if (diff < mid_range_light ) {diff = mid_range_light;}
		if (diff >= max_light) {diff = max_light;}
		LIGHT *= light_calc(diff, would_be_strength);
	} else { 
		if (min_light != 0.0) { 
			LIGHT_VEC = -NORMAL.xy*length(LIGHT_VEC); 
		}
		LIGHT *= min_light;                                                                                                                                  
	}
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_yog4a"]
shader = SubResource("Shader_1c764")

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_cu5kx"]
texture = ExtResource("3_1yb1k")
texture_region_size = Vector2i(8, 8)
0:0/0 = 0
0:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
0:0/0/physics_layer_1/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:0/0 = 0
1:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:0/0/physics_layer_1/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
0:1/0 = 0
0:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
0:1/0/physics_layer_1/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:1/0 = 0
1:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:1/0/physics_layer_1/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:0/0 = 0
2:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:0/0 = 0
3:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:1/0 = 0
3:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:1/0 = 0
2:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:2/0 = 0
3:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:2/0 = 0
2:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:2/0 = 0
1:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
0:2/0 = 0
0:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:2/0 = 0
4:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:2/0 = 0
5:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:1/0 = 0
5:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:0/0 = 0
5:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:0/0 = 0
4:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:1/0 = 0
4:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:8/0 = 0
2:8/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:8/0 = 0
3:8/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:8/0 = 0
4:8/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:8/0 = 0
5:8/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:9/0 = 0
5:9/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:10/0 = 0
5:10/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
5:11/0 = 0
5:11/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:11/0 = 0
4:11/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:11/0 = 0
3:11/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:11/0 = 0
2:11/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:10/0 = 0
2:10/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
2:9/0 = 0
2:9/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:9/0 = 0
3:9/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:9/0 = 0
4:9/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
4:10/0 = 0
4:10/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
3:10/0 = 0
3:10/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)

[sub_resource type="TileSet" id="TileSet_fkjq7"]
tile_size = Vector2i(8, 8)
physics_layer_0/collision_layer = 1
physics_layer_1/collision_layer = 2
physics_layer_1/collision_mask = 2
sources/2 = SubResource("TileSetAtlasSource_cu5kx")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_ncfhr"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_k1ss2"]
seamless = true
noise = SubResource("FastNoiseLite_ncfhr")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0kuwi"]
shader = ExtResource("6_olox2")
shader_parameter/CAST_COLOR = Color(0, 0, 0.054902, 1)
shader_parameter/fast_noise = SubResource("NoiseTexture2D_k1ss2")
shader_parameter/speed = Vector2(0.295, 0.03)
shader_parameter/wave_strength = 3.98
shader_parameter/scale_y = 8.09
shader_parameter/y_zoom = 0.26

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0ev06"]
shader = ExtResource("5_xfjr0")
shader_parameter/resolution = Vector2(320, 180)
shader_parameter/scan_line_amount = 0.599
shader_parameter/warp_amount = 0.235
shader_parameter/noise_amount = 0.0
shader_parameter/interference_amount = 0.0
shader_parameter/grille_amount = 0.0
shader_parameter/grille_size = 1.0
shader_parameter/vignette_amount = 0.747
shader_parameter/vignette_intensity = 0.157
shader_parameter/aberation_amount = 0.096
shader_parameter/roll_line_amount = 0.0
shader_parameter/roll_speed = 4.429
shader_parameter/scan_line_strength = -8.47
shader_parameter/pixel_strength = -4.0

[node name="Game" type="Node2D"]
script = ExtResource("1_o0h88")

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2(248, 80)
scale = Vector2(1.44483, 0.264237)
zoom = Vector2(5, 5)

[node name="map" type="Node" parent="."]

[node name="TileMap" type="TileMap" parent="map"]
material = SubResource("ShaderMaterial_yog4a")
position = Vector2(249, 97)
tile_set = SubResource("TileSet_fkjq7")
format = 2
layer_0/name = "normal"
layer_0/tile_data = PackedInt32Array(65536, 65538, 0, 131071, 65538, 0, 131070, 65538, 0, 131069, 65538, 0, 65532, 131074, 0, -5, 131074, 0, -6, 65538, 0, -7, 65538, 0, -8, 65538, 0, 65537, 65538, 0, 65538, 65538, 0, 65539, 131074, 0, 131075, 196610, 2, 196604, 65538, 1, 196605, 65538, 1, 196606, 65538, 1, 196607, 65538, 1, 131072, 65538, 1, 131073, 65538, 1, 131074, 65538, 1, 131068, 196610, 2, 131067, 65538, 1, 65531, 196610, 2, 65530, 65538, 1, 65529, 65538, 1, 65528, 65538, 1, 131064, 65538, 1, 131065, 65538, 1, 131066, 65538, 1, 196602, 65538, 1, 196603, 65538, 1, 196600, 65538, 1, 196601, 65538, 1, -9, 65538, 0, 65527, 65538, 1, 131063, 65538, 1, 196599, 65538, 1, 196597, 65538, 1, 131062, 65538, 1, 196598, 65538, 1, -10, 65538, 0, 65526, 65538, 1, 131061, 65538, 1, 65525, 65538, 1, -11, 65538, 0, 131076, 131074, 0, -12, 65538, 0, -14, 65538, 0, -15, 65538, 0, -16, 65538, 0, -18, 65538, 0, -19, 65538, 0, -20, 65538, 0, -17, 65538, 0, 65521, 65538, 1, 65522, 65538, 1, -13, 65538, 0, 65516, 65538, 1, 65517, 65538, 1, 65518, 65538, 1, 65519, 65538, 1, 65520, 65538, 1, 65523, 65538, 1, 65524, 65538, 1, 131060, 65538, 1, 196596, 65538, 1, 196595, 65538, 1, 196594, 65538, 1, 131058, 65538, 1, 131059, 65538, 1, 131057, 65538, 1, 131056, 65538, 1, 196592, 65538, 1, 196591, 65538, 1, 196590, 65538, 1, 131054, 65538, 1, 131055, 65538, 1, 196593, 65538, 1, 196589, 65538, 1, 196588, 65538, 1, 131052, 65538, 1, 131053, 65538, 1, 262125, 65538, 1, 262124, 65538, 1, 327660, 65538, 1, 393196, 65538, 1, 393197, 65538, 1, 327661, 65538, 1, 327662, 65538, 1, 262126, 65538, 1, 262127, 65538, 1, 262128, 65538, 1, 262129, 65538, 1, 327665, 65538, 1, 393201, 65538, 1, 393200, 65538, 1, 458736, 65538, 1, 458735, 65538, 1, 393199, 65538, 1, 327663, 65538, 1, 327664, 65538, 1, 393198, 65538, 1, 458734, 65538, 1, 458733, 65538, 1, 458732, 65538, 1, 524272, 65538, 1, 524273, 65538, 1, 524274, 65538, 1, 524275, 65538, 1, 524276, 65538, 1, 458738, 65538, 1, 458737, 65538, 1, 458739, 65538, 1, 458740, 65538, 1, 393204, 65538, 1, 393205, 65538, 1, 393206, 65538, 1, 393207, 65538, 1, 393208, 65538, 1, 393209, 65538, 1, 393210, 65538, 1, 393211, 65538, 1, 393212, 65538, 1, 327676, 65538, 1, 393213, 65538, 1, 393214, 65538, 1, 393215, 65538, 1, 327680, 65538, 1, 327681, 65538, 1, 327682, 65538, 1, 327683, 65538, 1, 327684, 65538, 1, 262148, 65538, 1, 262147, 65538, 1, 196611, 65538, 1, 196610, 65538, 1, 262146, 65538, 1, 262145, 65538, 1, 262144, 65538, 1, 327679, 65538, 1, 327678, 65538, 1, 327677, 65538, 1, 196609, 65538, 1, 196608, 65538, 1, 262143, 65538, 1, 262139, 65538, 1, 262140, 65538, 1, 262141, 65538, 1, 262142, 65538, 1, 327675, 65538, 1, 327674, 65538, 1, 327673, 65538, 1, 262137, 65538, 1, 262138, 65538, 1, 327672, 65538, 1, 327671, 65538, 1, 327669, 65538, 1, 327668, 65538, 1, 327667, 65538, 1, 393203, 65538, 1, 393202, 65538, 1, 327666, 65538, 1, 262130, 65538, 1, 262131, 65538, 1, 262132, 65538, 1, 262133, 65538, 1, 262134, 65538, 1, 262135, 65538, 1, 327670, 65538, 1, 262136, 65538, 1, 458742, 65538, 1, 458741, 65538, 1, 458743, 65538, 1, 458744, 65538, 1, 458745, 65538, 1, 458746, 65538, 1, 458750, 65538, 1, 458749, 65538, 1, 524284, 65538, 1, 524283, 65538, 1, 524282, 65538, 1, 458747, 65538, 1, 458748, 65538, 1, 393216, 65538, 1, 393217, 65538, 1, 458753, 65538, 1, 458752, 65538, 1, 524287, 65538, 1, 458751, 65538, 1, 393218, 65538, 1, 393219, 65538, 1, 458755, 65538, 1, 393220, 65538, 1, 393221, 65538, 1, 196612, 196610, 2, 262149, 65538, 1, 262150, 65538, 1, 262151, 65538, 1, 327688, 65538, 1, 327689, 65538, 1, 327690, 65538, 1, 327691, 196610, 2, 327692, 65538, 0, 327693, 65538, 0, 327694, 327682, 2, 327695, 65538, 1, 327696, 65538, 1, 327697, 65538, 1, 327698, 65538, 1, 327699, 65538, 1, 393235, 65538, 1, 393234, 65538, 1, 458770, 65538, 1, 458769, 65538, 1, 458768, 65538, 1, 458767, 65538, 1, 458766, 65538, 1, 393229, 65538, 1, 393230, 65538, 1, 393231, 65538, 1, 393232, 65538, 1, 393233, 65538, 1, 393228, 65538, 1, 393227, 65538, 1, 393226, 65538, 1, 393225, 65538, 1, 393224, 65538, 1, 458759, 65538, 1, 458758, 65538, 1, 393222, 65538, 1, 327686, 65538, 1, 327687, 65538, 1, 262152, 65538, 1, 393223, 65538, 1, 327685, 65538, 1, 196616, 65538, 0, 196615, 65538, 0, 196614, 65538, 0, 262154, 65538, 0, 262155, 131074, 0, 262158, 2, 0, 262159, 65538, 0, 262160, 65538, 0, 262161, 65538, 0, 262162, 65538, 0, 262153, 196610, 2, 196617, 131074, 0, 196613, 65538, 0, 262163, 65538, 0)

[node name="Grass" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(176, 80)

[node name="Grice" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(160, 80)

[node name="light" type="PointLight2D" parent="map"]
position = Vector2(240, 96)
scale = Vector2(1.375, 0.597656)
color = Color(0.540444, 0.0466421, 0.606464, 1)
energy = 2.57
shadow_enabled = true
shadow_color = Color(0, 0, 0, 1)
texture = ExtResource("2_igyqu")

[node name="Grass2" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(240, 96)

[node name="Grass3" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(192, 80)

[node name="Grass4" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(304, 112)

[node name="Grass5" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(272, 96)

[node name="Grass6" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(336, 120)

[node name="Grass7" parent="map" instance=ExtResource("6_2t1ve")]
position = Vector2(112, 80)

[node name="Water" type="Sprite2D" parent="map"]
material = SubResource("ShaderMaterial_0kuwi")
position = Vector2(264, 168)
scale = Vector2(2.5, 0.21875)
texture = ExtResource("2_igyqu")

[node name="Loaf" parent="." instance=ExtResource("9_2vfwe")]
position = Vector2(136, 80)

[node name="Burbur" parent="." instance=ExtResource("1_txd6a")]
position = Vector2(256, 96)

[node name="Pause Menu" parent="." instance=ExtResource("7_4ca43")]
visible = false
offset_left = 168.0
offset_top = 34.0
offset_right = 168.0
offset_bottom = 34.0

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="ColorRect" type="ColorRect" parent="CanvasLayer"]
material = SubResource("ShaderMaterial_0ev06")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
metadata/_edit_use_anchors_ = true
